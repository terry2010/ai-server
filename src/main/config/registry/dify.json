{
  "name": "dify",
  "type": "feature",
  "image": "langgenius/dify-api:latest",
  "dependsOn": ["postgres", "redis", "qdrant"],
  "ports": [
    { "container": 5001, "host": "${DIFY_API_PORT:18091}", "bind": "${BIND_ADDRESS:127.0.0.1}" }
  ],
  "env": {
    "DIFY_BIND_ADDRESS": "0.0.0.0",
    "DIFY_PORT": "5001",
    "STORAGE_TYPE": "opendal",
    "OPENDAL_SCHEME": "fs",
    "OPENDAL_FS_ROOT": "/app/storage",
    "CONSOLE_CORS_ALLOW_ORIGINS": "http://localhost:${DIFY_WEB_PORT:18090},http://127.0.0.1:${DIFY_WEB_PORT:18090}",
    "APP_CORS_ALLOW_ORIGINS": "http://localhost:${DIFY_WEB_PORT:18090},http://127.0.0.1:${DIFY_WEB_PORT:18090}",
    "WEB_API_CORS_ALLOW_ORIGINS": "http://localhost:${DIFY_WEB_PORT:18090},http://127.0.0.1:${DIFY_WEB_PORT:18090}",
    "DB_USERNAME": "${POSTGRES_USER:ai_server}",
    "DB_PASSWORD": "${POSTGRES_PASSWORD:ai_server_123}",
    "DB_HOST": "ai-postgres",
    "DB_PORT": "5432",
    "DB_DATABASE": "${DIFY_DB_NAME:ai_server}",
    "REDIS_HOST": "ai-redis",
    "REDIS_PORT": "6379",
    "REDIS_PASSWORD": "",
    "CELERY_BROKER_URL": "redis://:@ai-redis:6379/1",
    "QDRANT_URL": "http://ai-qdrant:6333",
    "CONSOLE_API_URL": "http://localhost:${DIFY_API_PORT:18091}",
    "CONSOLE_WEB_URL": "http://localhost:${DIFY_WEB_PORT:18090}",
    "SERVICE_API_URL": "http://localhost:${DIFY_API_PORT:18091}",
    "APP_API_URL": "http://localhost:${DIFY_API_PORT:18091}",
    "APP_WEB_URL": "http://localhost:${DIFY_WEB_PORT:18090}",
    "FILES_URL": "http://localhost:${DIFY_API_PORT:18091}"
  },
  "variables": {
    "DIFY_WEB_PORT": "${DIFY_WEB_PORT:18090}",
    "DIFY_API_PORT": "${DIFY_API_PORT:18091}",
    "BIND_ADDRESS": "${BIND_ADDRESS:127.0.0.1}",
    "DIFY_SECRET_KEY": "${DIFY_SECRET_KEY:please-change-me}",
    "DIFY_PLUGIN_INNER_API_KEY": "${DIFY_PLUGIN_INNER_API_KEY:QaHbTe77CtuXmsfyhR7+vRjI/+XbV1AaFy691iy+kGDv2Jvy0/eAh8Y1}",
    "DIFY_PLUGIN_DAEMON_KEY": "${DIFY_PLUGIN_DAEMON_KEY:lYkiYYT6owG+71oLerGzA7GXCgOT++6ovaezWAjpCjf+Sjc3ZtU+qUEi}",
    "DIFY_PLUGIN_DB": "${DIFY_PLUGIN_DB:ai_server_plugin}",
    "QDRANT_PORT": "${QDRANT_PORT:16333}"
  },
  "healthCheck": { "type": "http", "target": "http://localhost:${DIFY_API_PORT:18091}/", "interval": 2000, "timeout": 20000, "retries": 30 },
  "compose": { "templateRef": "docker-compose.feature.yml" }
}
